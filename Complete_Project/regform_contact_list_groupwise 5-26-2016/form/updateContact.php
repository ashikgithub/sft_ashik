<?php // **********************start database connection and session********************	session_start();	include 'config.php';	if( !isset( $_SESSION['email'] ) && !isset( $_SESSION['pass'] ) )	{		header("location:signin.php");	}		if(isset($_REQUEST['id']))	{		$id= $_REQUEST['id'] ;			}	else	{		header('location:signin.php');	}?><!-- *****************update only for user************************--><!DOCTYPE HTML>  <html> 	<header>		<title>Update</title>		<meta charset="utf-8"/>		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>		<link rel = "stylesheet" href = "css/bootstrap.min.css"/>		<link rel = "stylesheet" href = "css/styles.css"/>		<script src="js/bootstrap.min.js"></script>		<script src="js/jquery.min.js"></script>			</header>	<body>	<div class="wrapper">		<div class="container">			<div class="contact_main col-md-offset-2 col-md-8">				<div class="col-md-12 col-sm-12  contact_header text-center">					<h2>Edit Contact</h2><!-- *******************menu section for user**************************** -->					<div class="menu col-md-offset-7 col-md-5 text-right">						<ul>							<li><a href ="userprofile.php">Home</a></li>							<li><a href="usercontactList.php?id=<?php echo $id;?>">View</a></li>						</ul>					</div>				</div>										<?php//*****************input field validation**************************					$firststnameErr = $lastnameErr = $addressErr = $emailErr = $contact_dateErr = $phoneErr = $imgerror ="";					$err1= $err2= $err3=$err4=$err5=$err6="" ;					$errors = array();						if(isset($_POST['send']))					{							if (!preg_match("/^[a-zA-Z ]*$/", $_POST['f_name']))						{							$errors['firststnameErr']="Please enter your valid first name";							$err1 =$errors['firststnameErr'];						}						if (!preg_match("/^[a-zA-Z ]*$/", $_POST['l_name']))						{							$errors['lastnameErr']="Please enter your valid lastt name";							$err2 =$errors['lastnameErr'];						}						if (!preg_match("/[A-Za-z0-9\-\\,.]+/", $_POST['u_address']))						{							$errors['addressErr']="invalid address";							$err3 =$errors['addressErr'];						}						 if (!filter_var($_POST['u_email'],FILTER_VALIDATE_EMAIL))						{								$errors['emailErr']="invalid email";							$err4 =$errors['emailErr'];						}						if ( !preg_match("/^[0-9]{4}-[0-1][0-9]-[0-3][0-9]$/", $_POST['u_contact_date']) )//2012-09-12						{							$errors['contact_dateErr']="invalid date format";							$err5 =$errors['contact_dateErr'];						}						if (!preg_match("/^[0-9]{3}-[0-9]{4}-[0-9]{4}$/", $_POST['u_phone']))						{							$errors['phoneErr']="invalid phone number";							$err6 =$errors['phoneErr'];						}							$firststname = $_POST['f_name'];							$lastname = $_POST['l_name'];							$address = $_POST['u_address'];								$email = $_POST['u_email'];							$contact_date = $_POST['u_contact_date'];							$phone = $_POST['u_phone'];														if(empty($errors))							{//****************** php code for file(image) upload ***********************								$file_name=$_FILES["image_file"]["name"];								$file_ext = substr( $file_name, strripos($file_name, '.') );//******************verify img exten in .jpg & .png fornat**********************																if(!empty($file_name))								{									if( ($file_ext  == ".png") || ($file_ext == ".jpg"))									{										$target_path1= 'upload/'.$file_name;											$target_path=move_uploaded_file($_FILES["image_file"]["tmp_name"],'upload/'.$file_name);										$Query = "UPDATE tbl_contact SET firststname='$firststname', lastname='$lastname', address= '$address',										email= '$email', contact_date='$contact_date', phone= '$phone', 										image_name= '".$target_path1."' WHERE user_id='$id' ";/**/										mysql_query($Query);									}									else									{										$imgerror= "your uploaded file must be in png or jpg format ";									}								}										$target_path1= 'upload/'.$file_name;											$target_path=move_uploaded_file($_FILES["image_file"]["tmp_name"],'upload/'.$file_name);										$Query = "UPDATE tbl_contact SET firststname='$firststname', lastname='$lastname', address= '$address', 										email= '$email', contact_date='$contact_date', phone= '$phone' WHERE user_id='$id'";										mysql_query($Query);										echo "updated successfully";							}												}				?>				<?php 					$Query = "SELECT * FROM tbl_contact WHERE user_id = '$id' ";					$result = mysql_query($Query);										$firststname_old = $lastname_old=$address_old = $email_old= $contact_date_old=$phone_old=$image_old=$st_contact_id_old="";					//*****************php code for take existing field value*********************					while($row = mysql_fetch_array($result))					{						$st_contact_id_old=$row['st_contact_id'];						$firststname_old=$row['firststname'];						$lastname_old=$row['lastname'];						$address_old=$row['address'];						$email_old=$row['email'];						$contact_date_old=$row['contact_date'];						$phone_old=$row['phone'];						$image_old=$row['image_name'];					}			?>	<!-- ***************** html input form for user update******************* ?id=<?php  echo $id; ?> -->				<form class = "form-horizontal" method="post" action="" enctype="multipart/form-data">  <!--update.php --><!-- ***************** user first name*******************-->									<div class="form-group  ">						<label class=" col-md-2 col-md-offset-2 text-right" for="usrFN" > First Name: </label>						<div class="col-md-5  ">							<input type = "text" class = "form-control " id="usrFN" value="<?php echo $firststname_old; ?>" name="f_name" required>							<p class="error"><?php echo $err1;?></p>						</div>					</div><!-- ***************** user last name*******************-->							<div class="form-group">						<label for="usrLN" class="col-md-2 col-md-offset-2 text-right" >Last Name: </label>						<div class="col-md-5 ">							<input type = "text" class = "form-control " id="usrLN" value="<?php echo $lastname_old; ?>" name="l_name" required>							<p class="error"><?php echo $err2;?></p>						</div>					</div>	<!-- ***************** user addr*******************-->							<div class="form-group">						<label for="Address" class="col-md-2 col-md-offset-2 text-right" >Address: </label>						<div class="col-md-5 ">							<input type = "text" class = "form-control col-md-6" id="Address" value="<?php echo $address_old; ?>" name="u_address" >						<p class="error"><?php echo $err3;?></p>						</div>					</div><!-- ***************** user contact email*******************-->							<div class="form-group">						<label for="EMAIL" class="col-md-2 col-md-offset-2 text-right">Email: </label>						<div class="col-md-5 ">							<input type = "text" class = "form-control col-md-6 datepicker" id="EMAIL" value="<?php echo $email_old; ?>" name="u_email" required>							<p class="error"><?php echo $err4;?></p>						</div>					</div><!-- ***************** Date *******************-->								<div class="form-group">						<label for="DATE" class="col-md-2 col-md-offset-2 text-right">Date: </label>						<div class="col-md-5 ">							<input type = "text" class = "form-control col-md-6" id="DATE" value="<?php echo $contact_date_old; ?>" name="u_contact_date" required>							<p class="error"><?php echo $err5;?></p>						</div>					</div><!-- ***************** user Phone *******************-->										<div class="form-group">						<label for="phn" class="col-md-2 col-md-offset-2 text-right">Phone: </label>						<div class="col-md-5 ">							<input type = "text" class = "form-control col-md-6" id="phn" value="<?php echo $phone_old; ?>" name="u_phone" required>							<p class="error"><?php echo $err6;?></p>						</div>					</div>	<!-- ***************** user image*******************-->							<div class="form-group">						<label class="col-md-2 col-md-offset-2 text-right col-md-6">Image: </label>						<input type="file" name="image_file">						<p class="error col-md-offset-1 "><?php echo $imgerror;?></p>						<p class="col-md-offset-2 "><?php echo $image_old;?></p>					</div><!-- ***************** submit updated info************** -->												<div class="form-group" > 						<div class="col-md-offset-1 text-center">							<input class="btn btn-primary" type="submit" value="Update" name="send">												</div>					</div>					<input type="hidden" name="id" value="<?php echo $id;?>"/>				</form>			</div>					</div>	</div>	</body></html>